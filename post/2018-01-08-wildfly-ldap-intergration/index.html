<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=author content="dvogt">
<meta name=description content="personal developer blog for some coding notes.">
<meta name=keywords content="blog,tech,develop,software,coding">
<meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name=generator content="Hugo 0.88.1">
<link rel=canonical href=/post/2018-01-08-wildfly-ldap-intergration/>
<base href=/>
<meta property="og:title" content="Wildfly LDAP integration">
<meta property="og:description" content="LDAP login possibility for wildfly server">
<meta property="og:type" content="article">
<meta property="og:url" content="/post/2018-01-08-wildfly-ldap-intergration/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2018-04-02T00:00:00+00:00">
<meta property="article:modified_time" content="2018-04-02T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Wildfly LDAP integration">
<meta name=twitter:description content="LDAP login possibility for wildfly server">
<meta itemprop=name content="Wildfly LDAP integration">
<meta itemprop=description content="LDAP login possibility for wildfly server"><meta itemprop=datePublished content="2018-04-02T00:00:00+00:00">
<meta itemprop=dateModified content="2018-04-02T00:00:00+00:00">
<meta itemprop=wordCount content="482">
<meta itemprop=keywords content="wildfly,jboss,ldap,webserver,java,">
<link rel=stylesheet href=css/layout.css>
<link rel=stylesheet href=css/syntax.css>
<style type=text/css>body{background-color:#202020;color:#dbdbdb}a{color:#dbdbdb}pre{background:#1d1f21;border:1px solid #dbdbdb;border-radius:5px}code{background:#1d1f21}blockquote{background:#1d1f21;border-left:3px solid #dbdbdb}table{margin:1em auto;border-collapse:collapse}table,th,td{border:1px solid #dbdbdb}th{background:#dbdbdb;color:#202020}.siteTitle a{color:#b3b6b7}.post .content h1{color:#b3b6b7}.post .content h2{color:#b3b6b7}.post .content h3{color:#b3b6b7}.post .content h4{color:#b3b6b7}.post .content h5{color:#b3b6b7}.post .content h6{color:#b3b6b7}.post .content a:hover{color:#b3b6b7}.social-link:hover{color:#b3b6b7}.nav-item-title:hover{color:#b3b6b7}.tag a:hover{color:#b3b6b7}.copyright{color:#404040}.poweredby{color:#404040}.poweredby a{color:#404040}.post-preview .title a{color:#b3b6b7}.content-item a:hover{text-decoration:underline;color:#b3b6b7}.post-list .title{color:#b3b6b7}.rmore{color:#b3b6b7}.terms .term a:hover{text-decoration:underline;color:#b3b6b7}</style>
<script async defer data-website-id=aeec65b5-9542-46f0-bd03-fa96813535bb src=https://umami.vogt.dev/umami.js></script>
<title>
Wildfly LDAP integration
</title>
</head>
<body>
<div class=main>
<header>
<div class=header-bar>
<nav>
<div class=siteTitle>
<a href=/>blogðŸ““</a>
</div>
<a class=nav-item href=https://vogt.dev><div class=nav-item-title>web</div></a>
<a class=nav-item href=/tags/><div class=nav-item-title>tags</div></a>
<a class=nav-item href=/index.xml><div class=nav-item-title>rss</div></a>
</nav>
</div>
<div class=social-links-header>
</div>
</header>
<article class=post>
<h1 class=title> Wildfly LDAP integration </h1>
<p class=description> LDAP login possibility for wildfly server </p>
<div class=content> <p>In the past, I spent a lot of time to figuring out, how to add the integrated LDAP module of the wildfly server. To do this, you have to take changes in some different places:</p>
<h3 id=wildfly-server-side>Wildfly server side</h3>
<h4 id=add-ldapextended-module-in-wildfly-configuration>Add &lsquo;LDAPExtended&rsquo; module in wildfly configuration</h4>
<p>In the first place you have to add a module to your server configuration. Do it like this:
<code>Wildfly admin console: Configuration -> Subsystems -> Security -> [Add] Name: "LDAPAuth"</code> this name will be connected in the <code>jboss-web.xml</code> file in your project.</p>
<h4 id=add-some-configuration-parameters-to-this-module>Add some configuration parameters to this module</h4>
<p><code>View</code> the module configuration and add the following parameters:</p>
<pre tabindex=0><code>Name: LDAPAuth
Code: LdapExtended
Flag: required
Module:
Module options:
java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory
java.naming.provider.url=ldap://ldapserver:389
bindDN=CN=Testuser,OU=Groupes,DC=domain,DC=net
bindCredential=password
baseCtxDN=dc=domain,dc=net
rolesCtxDN=OU=Groupes,DC=domain,DC=net
roleFilter=(member={1})
roleAttributeID=memberOf
baseFilter=(sAMAccountName={0})
throwValidateError=true
searchScope=SUBTREE_SCOPE
distinguishedNameAttribute=distinguishedname
roleAttributeIsDN=true
roleNameAttributeID=cn
roleRecursion=1
</code></pre><p><strong>Hint:</strong> the module options will be hidden after you submit this to your module</p>
<p>After a reload of the server runtime, you must have some similiar in your <code>$JBOS_HOME/standalone/configuration/standalone.xml</code> file:</p>
<pre tabindex=0><code> &lt;subsystem xmlns=&quot;urn:jboss:domain:security:1.2&quot;&gt;
            &lt;security-domains&gt;
            [...]
                &lt;security-domain name=&quot;LDAPAuth&quot; cache-type=&quot;default&quot;&gt;
                    &lt;authentication&gt;
                        &lt;login-module name=&quot;LDAPAuth&quot; code=&quot;LdapExtended&quot; flag=&quot;required&quot;&gt;
                            &lt;module-option name=&quot;java.naming.factory.initial&quot; value=&quot;com.sun.jndi.ldap.LdapCtxFactory&quot;/&gt;
                            &lt;module-option name=&quot;java.naming.provider.url&quot; value=&quot;ldap://ldapserver:389&quot;/&gt;
                            &lt;module-option name=&quot;bindDN&quot; value=&quot;CN=Testuser,OU=Groupes,DC=domain,DC=net&quot;/&gt;
                            &lt;module-option name=&quot;bindCredential&quot; value=&quot;password&quot;/&gt;
                            &lt;module-option name=&quot;baseCtxDN&quot; value=&quot;dc=domain,dc=net&quot;/&gt;
                            &lt;module-option name=&quot;rolesCtxDN&quot; value=&quot;OU=Groupes,DC=domain,DC=net&quot;/&gt;
                            &lt;module-option name=&quot;roleFilter&quot; value=&quot;(member={1})&quot;/&gt;
                            &lt;module-option name=&quot;roleAttributeID&quot; value=&quot;memberOf&quot;/&gt;
                            &lt;module-option name=&quot;baseFilter&quot; value=&quot;(sAMAccountName={0})&quot;/&gt;
                            &lt;module-option name=&quot;throwValidateError&quot; value=&quot;true&quot;/&gt;
                            &lt;module-option name=&quot;searchScope&quot; value=&quot;SUBTREE_SCOPE&quot;/&gt;
                            &lt;module-option name=&quot;distinguishedNameAttribute&quot; value=&quot;distinguishedname&quot;/&gt;
                            &lt;module-option name=&quot;roleAttributeIsDN&quot; value=&quot;true&quot;/&gt;
                            &lt;module-option name=&quot;roleNameAttributeID&quot; value=&quot;cn&quot;/&gt;
                            &lt;module-option name=&quot;roleRecursion&quot; value=&quot;1&quot;/&gt;
                        &lt;/login-module&gt;
                    &lt;/authentication&gt;
                &lt;/security-domain&gt;
                &lt;security-domain name=&quot;test2322&quot; cache-type=&quot;default&quot;/&gt;
            &lt;/security-domains&gt;
        &lt;/subsystem&gt;
</code></pre><h3 id=project-environment>Project environment</h3>
<h4 id=add-a-jboss-webxml-file-with-a-connection-to-the-wildfly-module-in-your-project>Add a &lsquo;jboss-web.xml&rsquo; file with a connection to the wildfly module in your project</h4>
<p>To connect your application to the ldap module you have to add your wildfly server, add a <code>jboss-web.xml</code> file to your <code>WEB-INF</code> dir:</p>
<pre tabindex=0><code>&lt;jboss-web&gt;
    &lt;security-domain&gt;java:/jaas/LDAPAuth&lt;/security-domain&gt;
&lt;/jboss-web&gt;
</code></pre><h4 id=add-a-login-page-in-jsp-format-with-a-post-request-included-the-username-and-password-for-ldap-authentication>Add a login page in &lsquo;.jsp&rsquo; format with a POST request included the username and password for ldap authentication</h4>
<p>For a form like authentication method, you have to create some <code>jsp</code> files in <code>html</code> format to authenticate a user to the wildfly ldap module. Add this <code>login.jsp</code> file to your <code>WEBAPP</code> dir.</p>
<pre tabindex=0><code>&lt;form class=&quot;col s12&quot; method=&quot;post&quot; action=&quot;j_security_check&quot;&gt;
    &lt;div class='row'&gt;
        &lt;div class='input-field col s12'&gt;
            &lt;input type='text' name='j_username' id='j_username' placeholder=&quot;Username&quot; /&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class='row'&gt;
        &lt;div class='input-field col s12'&gt;
            &lt;input type='password' name='j_password' id='j_password' placeholder=&quot;Password&quot; /&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;br /&gt;
    &lt;center&gt;
        &lt;div class='row'&gt;
            &lt;button type='submit' name='btn_login' class='col s12 btn btn-large waves-effect red'&gt;Login&lt;/button&gt;
        &lt;/div&gt;
    &lt;/center&gt;
&lt;/form&gt;
</code></pre><h4 id=add-a-webxml-to-your-project-if-not-exist-with-some-security-contraints-like-ldap-group>Add a &lsquo;web.xml&rsquo; to your project, if not exist, with some security contraints, like ldap group</h4>
<p>To define some security constraints you have to add/create a <code>web.xml</code> file in your <code>WEB-INF</code> dir of your project with an similiar content:</p>
<pre tabindex=0><code>&lt;security-constraint&gt;
    &lt;display-name&gt;Login Form&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;HTML-Auth&lt;/web-resource-name&gt;
        &lt;description&gt;application security constraints&lt;/description&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;http-method&gt;GET&lt;/http-method&gt;
    &lt;http-method&gt;POST&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;

    &lt;auth-constraint&gt;
        &lt;role-name&gt;LDAPGroup&lt;/role-name&gt;
    &lt;/auth-constraint&gt;

    &lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;

&lt;login-config&gt;
    &lt;auth-method&gt;FORM&lt;/auth-method&gt;
    &lt;realm-name&gt;LDAPAuth realm&lt;/realm-name&gt;
    &lt;form-login-config&gt;
        &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;
        &lt;form-error-page&gt;/loginError.jsp&lt;/form-error-page&gt;
    &lt;/form-login-config&gt;
&lt;/login-config&gt;

&lt;session-config&gt;
    &lt;session-timeout&gt;30&lt;/session-timeout&gt;
&lt;/session-config&gt;

&lt;error-page&gt;
    &lt;error-code&gt;404&lt;/error-code&gt;
    &lt;location&gt;/404.html&lt;/location&gt;
&lt;/error-page&gt;
&lt;error-page&gt;
    &lt;error-code&gt;403&lt;/error-code&gt;
    &lt;location&gt;/403.html&lt;/location&gt;
&lt;/error-page&gt;

&lt;security-role&gt;
    &lt;role-name&gt;LDAPGroup&lt;/role-name&gt;
&lt;/security-role&gt;
</code></pre><h4 id=get-user-principal-of-ldap-authorization>Get user principal of ldap authorization</h4>
<p>After all this configuration and a successfully login of a user, you could get the username from the <code>vaadinRequest</code> in your <code>UI</code> like (kotlin):</p>
<pre tabindex=0><code>   override fun init(vaadinRequest: VaadinRequest) {
        vaadinRequest.userPrincipal.name
</code></pre> </div>
<footer class=post-footer>
Please comment @github: <a href="https://github.com/dvogt23/blog/issues/new?labels=comment&title=Page: Wildfly%20LDAP%20integration" target=_blank>comment</a>
</footer>
</article>
<footer>
<div class=copyright> Â© dima 2018 </div>
<div class=poweredby>
<a href=https://gohugo.io/ target=_blank>hugo</a>/<a href=https://github.com/gyorb/hugo-dusk target=_blank>hugo-dusk</a>
</div>
</footer>
</div>
</body>
</html>